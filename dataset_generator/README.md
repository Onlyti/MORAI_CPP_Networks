# Sensor Dataset Generator

## 구조 개요

이 프로그램은 MORAI 시뮬레이터의 센서 데이터를 수집하여 데이터셋을 생성하는 도구입니다.

### 주요 컴포넌트

1. **SensorRecorder 클래스**
   - 전체 데이터 수집 및 저장 프로세스를 관리
   - 센서 설정 로드 및 초기화
   - 데이터 수집 및 저장 관리

2. **데이터 처리 파이프라인**
   
   센서 데이터 발생 → 콜백 함수 호출 → 데이터 큐 저장 → 저장 스레드에서 처리 → 파일 시스템에 저장

### 주요 기능

1. **센서 데이터 수집**
   - Camera: 이미지 데이터
   - IMU: 가속도 및 각속도 데이터
   - GPS: 위치 데이터
   - Vehicle State: 차량 상태 정보

2. **데이터 저장 시스템**
   - 별도의 저장 스레드를 통한 비동기 처리
   - 큐 기반 데이터 관리
   - 타임스탬프 기반 파일 저장

### 데이터 흐름

    [센서 하드웨어] → [UDP 수신] → [콜백 처리] → [데이터 큐] → [저장 스레드] → [파일 시스템]

## 주요 클래스 및 구조체

1. **SensorInfo**
   - 센서의 기본 정보 저장
   - 위치, 회전, UDP 설정 등 포함

2. **SensorData**
   - 큐에 저장되는 데이터 구조체
   - 센서 타입, ID, 타임스탬프, 직렬화된 데이터 포함

3. **DatasetDirectory**
   - 데이터셋 디렉토리 구조 관리
   - 시나리오 및 센서별 저장 경로 생성

## 스레드 구조

1. **메인 스레드**
   - 프로그램 초기화 및 관리
   - 사용자 입력 처리

2. **저장 스레드**
   - 데이터 큐 모니터링
   - 파일 시스템 저장 작업 수행

## 데이터 저장 형식

1. **카메라 데이터**
   - JPEG 형식 이미지
   - 파일명: {timestamp_index}_Intensity.jpeg

2. **IMU 데이터**
   - 텍스트 파일 형식
   - 가속도 및 각속도 정보 포함

3. **GPS 데이터**
   - 텍스트 파일 형식
   - 위도, 경도, 고도 정보 포함

4. **차량 상태 데이터**
   - 텍스트 파일 형식
   - 위치, 속도, 가속도 등 포함

## 사용 방법

프로그램 실행:

    ./sensor_recorder <path_to_sensor_config.json> <path_to_dataset>

- path_to_sensor_config.json: 센서 설정 파일 (모라이 센서 configuration json) 경로
- path_to_dataset: 데이터셋 저장 경로

## 주의사항

1. **메모리 사용**
   - 큐 크기 제한 없음 (메모리 사용량 주의)
   - 대용량 이미지 데이터 처리 시 주의

2. **스레드 안전성**
   - 큐 접근 시 뮤텍스 사용
   - 콜백 함수에서 최소한의 처리만 수행

3. **성능 고려사항**
   - 데이터 직렬화/역직렬화 오버헤드
   - 파일 I/O 작업의 비동기 처리

